---
title: "Phylogenetic tree visualisation"
date: "2025-03-12"
---

Load libraries
```{r setup, include=FALSE}
library(ggtree)
library(phangorn)
library(ggplot2)
library(ggtreeExtra)
library(ape)
library(dplyr)
library(tidyr)
```

Import Newick tree file generated by FastTree and created a tree object
```{r}
tree <- read.tree("~/Desktop/GA2025/01.Short_read_workshop/SR_workshop/temp/tree_file.txt")
```

Now we can visualize the phylogenetic tree with ggtree
```{r}
ggtree(tree) + geom_tiplab()
```

This quick and easy tree doesn't include a reference genome, so we can use the midpoint() function of the phangorn package to reroot the tree at midpoint (i.e. locate the midpoint of the longest path between any two tips and place the root at that location, assuming a constant evolutionary rate).

```{r}
#Rerooting tree at midpoint
reroot_tree <- midpoint(tree)

# Rescale tree based on the maximum tree depth and plot a cleaned up version of the tree
tree_depth <- max(node.depth.edgelength(reroot_tree))

p0 <-  ggtree(reroot_tree) + 
  geom_tiplab(align = TRUE, linesize = 0.5) +  
  xlim(0, tree_depth * 1.2) +
  theme_tree2()
p0
```

Let's now visualise some of the genome quality metrics that were gathered during the workshop.
Read in the genome metadata.
```{r}
qual <- read.delim("~/Desktop/GA2025/01.Short_read_workshop/SR_workshop/temp/genome_quality.txt")
```

Join tree info with metadata.
```{r}
# Generate random values for each tip label in the data
d1 <- data.frame(id=reroot_tree$tip.label)
colnames(d1)[1] <- "ID"
d1 <- left_join(d1, qual, "ID")
```

Facet plot for completeness, contamination, and genome size.
```{r}
#Facet for tree
p1 <- ggtree(reroot_tree)
#Facet for genome completeness
p2 <- facet_plot(p1, panel="Completeness (%)", data=d1, geom=geom_point, aes(x=Completeness), color='red3')
#Facet for genome contamination
p3 <- facet_plot(p2, panel="Contamination (%)", data=d1, geom=geom_point, aes(x=Contamination), color='green4')
#Facet for genome size
p4 <- facet_plot(p3, panel="Genome Size (bp)", data=d1, geom=geom_segment, aes(x=0, xend=Genome_Size, y=y, yend=y), size=3, color='blue4')

# Show all three plots with a scale
p4 + theme_tree2()
```


